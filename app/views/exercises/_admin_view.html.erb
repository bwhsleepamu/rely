<div id="main_info">
  <h3>Main Information</h3>
  <dl class="dl-horizontal">
    <dt>Assigned By</dt>
    <dd><%= link_to @exercise.admin.name, @exercise.admin if @exercise.admin %></dd>

    <dt>Assigned At</dt>
    <dd><%= simple_time @exercise.assigned_at %></dd>

    <dt>Completed At</dt>
    <dd><%= simple_time @exercise.completed_at %></dd>

    <dt>Scoring Rule</dt>
    <dd><%= link_to @exercise.rule.name, @exercise.rule if @exercise.rule %></dd>

    <dt>Description</dt>
    <dd><%= simple_format @exercise.description %></dd>

    <dt>Assessment Type</dt>
    <dd><%= @exercise.assessment_type %></dd>
  </dl>
</div>

<div id="status">
  <h3>Completion Status</h3>
  <p><%= "#{@exercise.count_completed}/#{@exercise.scorers.length}" %></p>

  <ul id="finished">
    <% @exercise.finished_scorers.each do |scorer| %>
      <li class="scorer"><%= link_to scorer.name, scorer %></li>
    <% end %>
  </ul>

  <ul id="pending">
    <% @exercise.pending_scorers.each do |scorer| %>
      <li class="scorer"><%= link_to "#{scorer.name}: #{@exercise.count_completed_results(scorer)}/#{@exercise.all_studies.length}", scorer %></li>
    <% end %>
  </ul>
</div>

<div id="results">
  <h3>Results</h3>
  <table class="table table-striped table-bordered dataTable">
    <thead>
      <tr>
        <th>Scorer</th>
        <th>Group</th>
        <th>Study</th>
        <th>Reliability Id</th>
        <th>Result Type</th>
        <th>Result Location</th>
        <% Assessment::TYPES[@exercise.assessment_type.to_sym][:questions].each do |q_hash| %>
          <th>Assessment Question <%= q_hash[:id] %></th>
        <% end %>
      </tr>
    </thead>
    <tbody>
      <% @exercise.reliability_ids.each do |r_id| %>
        <tr>
          <th><%= link_to r_id.user.name, r_id.user  %></th>
          <th><%= link_to r_id.group.name, r_id.group %></th>
          <th><%= link_to r_id.study.name, r_id.study %></th>
          <th><%= r_id.unique_id %></th>
          <% if r_id.result %>
            <th><%= r_id.result.result_type %></th>
            <th><%= r_id.result.location %></th>
            <% r_id.result.assessment.assessment_results.each do |a_r| %>
              <th><%= a_r.answer  %></th>
            <% end %>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
